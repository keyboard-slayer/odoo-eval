<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_employee_cv">
        <t t-set="full_width" t-value="True"/>
        <t t-call="web.basic_layout">
        <t t-foreach="docs" t-as="o">
            <div class="o_employee_cv page position-relative m-0 p-0 fs-6 text-700">
                <t t-call="hr_skills.report_employee_cv_company"/>
                <t t-call="hr_skills.report_employee_cv_sidepanel"/>
                <t t-call="hr_skills.report_employee_cv_main_panel"/>
                <p class="o_new_page"/>
            </div>
        </t>
        </t>
    </template>

    <template id="report_employee_cv_company">
        <div class="o_company row d-inline-block align-top text-center">
            <div class="col-12 mb-4">
                <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" style="max-height: 45px;" alt="Logo"/>
            </div>
            <div class="col-12 mb-4" style="font-weight: bold;">
              <t t-esc="o.company_id.partner_id.name"/>
            </div>
            <div class="col-12" t-field="o.company_id.partner_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/>
        </div>
    </template>

    <template id="report_employee_cv_sidepanel">
        <div class="o_sidebar d-inline-block w-50 text-white align-top" t-attf-style="
            background: #{color_primary};
            background-color: #{color_primary};">
            <div class="o_profile pe-4 ps-3 py-3 text-center">
                <img class="o_profile_image img img-fluid float-end mb-3 rounded-circle" t-attf-src="data:image/png;base64,#{o.image_128}" alt="" t-if="o.image_128"/>
                <h1 class="o_profile_name my-2 h2 fw-bolder" t-field="o.name"/>
                <h3 class="o_profile_job mt-0 mb-4 fs-6 fw-bold" t-field="o.job_id"/>
            </div>
            <div class="o_sidebar_section p-3" t-if="show_contact">
                <ul class="o_social ms-2 list-unstyled">
                    <li class="email" t-if="o.company_id.email">
                        <i class="fa fa-solid fa-envelope pe-2 text-white"/>
                        <a t-attf-href="mailto: #{o.company_id.email}" t-field="o.company_id.email" class="text-white text-decoration-none"/>
                    </li>
                    <li class="phone" t-if="o.company_id.mobile">
                        <i class="fa fa-solid fa-phone pe-2"/>
                        <a t-attf-href="tel:#{o.company_id.mobile}" t-field="o.company_id.mobile" class="text-white text-decoration-none"/>
                    </li>
                    <li class="website" t-if="o.company_id.website">
                        <i class="fa fa-solid fa-globe pe-2"/>
                        <a t-attf-href="tel:#{o.company_id.website}" t-field="o.company_id.website" class="text-white text-decoration-none"/>
                    </li>
                </ul>
            </div>
        </div>
    </template>

    <template id="report_employee_cv_main_panel">
        <t t-foreach="resume_lines[o]" t-as="line_type">
            <div class="o_main_panel d-inline-block w-100 px-3 pt-1 pb-0 bg-white align-top">
                <div class="o_main_panel_section">
                    <h2 class="o_main_panel_title position-relative mt-4 mb-3 fs-5 fw-bold text-uppercase" t-attf-style="color: #{color_secondary};">
                        <i class="fa fa-solid fa-briefcase fa-stack me-2 rounded-circle fs-6 text-white text-center" t-attf-style="background-color: #{color_secondary};"/>
                        <t t-esc="line_type"/>
                    </h2>
                    <t t-foreach="resume_lines[o][line_type]" t-as="resume_line">
                        <div class="o_main_panel_resume_title position-relative w-100 mb-0 ps-5 overflow-hidden">
                            <div class="o_main_panel_resume_title_job d-inline-block">
                                <h3 class="o_main_panel_resume_job my-0 fs-6 fw-bold text-700" t-field="resume_line.name"/>
                            </div>
                            <div class="o_main_panel_resume_title_dates float-end text-nowrap">
                                <t t-set="present">Present</t>
                                <div class="o_main_panel_resume_year position-static top-0 end-0 d-block mt-2 text-500">
                                    <t t-esc="resume_line.date_start.year"/> - <t t-esc="resume_line.date_end.year if resume_line.date_end else present"/>
                                </div>
                            </div>
                        </div>
                        <div class="o_main_panel_resume_description ps-5">
                            <p t-field="resume_line.description"/>
                        </div>
                    </t>
                </div>
            </div>
        </t>

        <t t-set="has_languages" t-value="skill_type_language and any(skill_line.skill_type_id == skill_type_language for skill_line in o.employee_skill_ids)"/>
        <div class="o_main_panel w-100 mt-4 px-3 pt-1 pb-0 align-top" t-if="has_languages">
            <div class="o_main_panel_section" t-if="skill_type_language">
                <h2 class="o_main_panel_title position-relative mt-0 mb-3 fs-5 fw-bold text-uppercase" t-attf-style="color: #{color_secondary};">
                        <i class="fa fa-solid fa-language fa-stack me-2 rounded-circle fs-6 text-white text-center" t-attf-style="background-color: #{color_secondary};"/>
                    Languages
                </h2>
                <t t-foreach="o.employee_skill_ids" t-as="skill_line">
                    <t t-if="skill_line.skill_type_id == skill_type_language">
                        <div class="o_main_panel_resume_title position-relative mb-0 ps-5 pb-2 overflow-hidden">
                            <div class="o_main_panel_resume_title_job">
                                <h3 class="o_main_panel_resume_job my-0 fs-6 fw-bold text-700"><t t-esc="skill_line.skill_id.name"/> - <t t-esc="skill_line.skill_level_id.name"/></h3>
                            </div>
                        </div>
                    </t>
                </t>
            </div>
        </div>

        <t t-set="has_skills" t-value="show_skills and any(skill_line.skill_type_id != skill_type_language for skill_line in o.employee_skill_ids)"/>
        <div class="o_main_panel w-100 mt-4 px-3 pt-1 pb-0 align-top" t-if="has_skills">
            <div class="o_main_panel_section">
                <h2 class="o_main_panel_title position-relative mt-0 mb-3 fs-5 fw-bold text-uppercase" t-attf-style="color: #{color_secondary};">
                        <i class="fa fa-solid fa-rocket fa-stack me-2 rounded-circle fs-6 text-white text-center" t-attf-style="background-color: #{color_secondary};"/>
                    Skills
                </h2>
                <t t-set="valid_skills" t-value="[skill for skill in o.employee_skill_ids if skill.skill_type_id != skill_type_language]"/>
                <!-- Thanks wkhtmltopdf -->
                <t t-foreach="[valid_skills[n:n+2] for n in range(0, len(valid_skills), 2)]" t-as="skills_pair">
                    <div class="o_main_panel_skills row ps-5">
                        <t t-foreach="skills_pair" t-as="skill_line">
                            <div class="o_main_panel_skill_line col-6 pe-4" t-if="skill_line.skill_type_id != skill_type_language">
                                <h3 class="o_main_panel_skill_name mt-0 mb-2 fs-6 fw-bolder" t-field="skill_line.skill_id"/>
                                <div class="progress o_main_panel_skill_progress_bar rounded-1 bg-200">
                                    <div
                                        class="o_main_panel_skill_progress_bar_color"
                                        role="progressbar"
                                        t-attf-style="width: #{skill_line.level_progress}%; background: #{color_primary};"
                                        t-att-aria-valuenow="skill_line.level_progress"
                                        aria-valuemin="0"
                                        aria-valuemax="100"/>
                                </div>
                            </div>
                        </t>
                    </div>
                </t>
            </div>
        </div>
    </template>
</odoo>
