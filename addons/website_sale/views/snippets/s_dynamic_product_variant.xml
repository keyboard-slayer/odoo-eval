<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- For a Drag N Drop Snippet -->
    <template id="s_dynamic_product_variant">
        <section class="s_dynamic_product_variant_snippet">
            <div class="s_dynamic_product_variant_class"/>
        </section>
    </template>

    <template id="dynamic_product_variant">
        <section class="s_dynamic_product_variant_snippet">
            <t t-set="combination" t-value="product._get_first_possible_combination()"/>
            <t t-set="attribute_exclusions" t-value="product._get_attribute_exclusions(parent_combination)"/>
            <t t-set="combination_info" t-value="product._get_combination_info(combination, add_qty=add_qty or 1, pricelist=pricelist)"/>
            <t t-set="tab_index" t-value="0"/>
                <ul t-attf-class="list-unstyled js_add_cart_variants mb-0 #{ul_class}" t-att-data-attribute_exclusions="json.dumps(attribute_exclusions)">
                    <!-- <div>
                        <h3 t-field="product.list_price" class="oe_price"
                            t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                    </div> -->
                    <div class="d-md-flex flex-items-start" >
                        <div class="nav flex-md-column align-items-start nav-pills me-3 mb-2" id="v-pills-tab" role="tablist" >
                            <t t-foreach="product.valid_product_template_attribute_line_ids" t-as="ptal">
                                <button t-attf-class="nav-link #{'active' if ptal_index==0 else ''}" type="button" t-att-id="ptal.attribute_id.id" t-attf-data-bs-target="##{ptal.attribute_id.name}" role="tab" aria-selected="false">
                                    <i class="fa fa-check d-none"></i>
                                    <span t-field="ptal.attribute_id.name"/>
                                    <span class="selected_variant">
                                        <t t-esc="'('+combination[ptal_index].name+')'"/>
                                    </span>
                                </button>
                            </t>
                        </div>
                        <div class="tab-content" id="v-pills-tabContent">
                            <t t-foreach="product.valid_product_template_attribute_line_ids" t-as="ptal">
                                <t t-set="single" t-value="len(ptal.product_template_value_ids._only_active()) == 1"/>
                                <t t-set="single_and_custom" t-value="single and ptal.product_template_value_ids._only_active()[0].is_custom" />
                                <div t-attf-class="tab-pane fade show #{'active' if ptal_index==0 else ''}" t-att-id="ptal.attribute_id.name" role="tabpanel" t-att-aria-labelledby="ptal.attribute_id.id">
                                    <t t-foreach="ptal.product_template_value_ids._only_active()" t-as="ptav">
                                        <li t-attf-class="o_variant_pills btn btn-primary mb-1 list-inline-item js_attribute_value">
                                            <label>
                                                <!-- If not color attribute -->
                                                <span t-if="not ptav.html_color" t-field="ptav.image_1920" t-options="{'widget': 'image', 'qweb_img_responsive': False, 'class': 'o_image_64_cover'}"/>
                                                <!-- If color attribute -->
                                                <div t-if="ptav.html_color" t-attf-style="background-color:#{ptav.html_color or ptav.product_attribute_value_id.name if not ptav.is_custom else ''}" t-attf-class="m-auto o_image_64_contain #{'active' if ptav in combination else ''} #{'custom_value' if ptav.is_custom else ''} #{'transparent' if (not ptav.is_custom and not ptav.html_color) else ''}"/>
                                                <div class="radio_input_value o_variant_pills_input_value">
                                                    <input type="radio"
                                                            t-attf-class="d-none js_variant_change #{ptal.attribute_id.create_variant}"
                                                            t-att-name="'ptal-%s' % ptal.id"
                                                            t-att-checked="ptav in combination"
                                                            t-att-value="ptav.id"
                                                            t-att-data-value_id="ptav.id"
                                                            t-att-id="ptav.id"
                                                            t-att-data-value_name="ptav.name"
                                                            t-att-data-attribute_name="ptav.attribute_id.name"
                                                            t-att-data-is_custom="ptav.is_custom"
                                                            t-att-data-is_single="single"
                                                            t-att-data-is_single_and_custom="single_and_custom"
                                                            t-att-autocomplete="off"/>
                                                        <div class="text-truncate" style="width:64px;" t-field="ptav.name" t-att-title="ptav.name"/>
                                                    <t t-call="website_sale.badge_extra_price"/>
                                                </div>
                                            </label>
                                        </li>
                                    </t>
                                </div>
                            </t>
                        </div>
                    </div>
                <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-primary bt-sm m-2 move_to_next">
                        <span class="badge rounded-pill text-bg-light border">
                            <span class="sign_badge_price_extra">+</span>
                            <span class="oe_price" style="white-space: nowrap;" t-esc="combination_info['price']"
                                t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                        </span>
                        Next
                    </button>
                    <button type="button" class="btn btn-primary bt-sm m-2 move_to_prev">
                        Back
                    </button>
                </div>
                <div id="selectedItem"></div>
                <!-- <t t-call="website_sale.selected_variant"/> -->
                <div
                    data-selector=".s_dynamic_product_variant_snippet"
                    data-drop-in=".js_add_cart_variants"/>
            </ul>
        </section>
    </template>

   <!-- JS file -->
    <record id="website_sale.s_dynamic_product_variant_000_js" model="ir.asset">
        <field name="name">s_dynamic_product_variant 000 JS</field>
        <field name="bundle">web.assets_frontend</field>
        <field name="path">website_sale/static/src/snippets/s_dynamic_product_variant/000.js</field>
    </record>
    <!-- XMl file  -->
    <record id="website_sale.s_dynamic_product_variant_000_xml" model="ir.asset">
        <field name="name">s_dynamic_product_variant 000 XML</field>
        <field name="bundle">web.assets_frontend</field>
        <field name="path">website_sale/static/src/snippets/s_dynamic_product_variant/000.xml</field>
    </record>
</odoo>
