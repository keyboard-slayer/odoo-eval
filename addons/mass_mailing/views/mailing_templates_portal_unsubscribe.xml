<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="page_mailing_unsubscribe" name="Unsubscribe">
        <t t-call="mass_mailing.layout">
            <t t-call="mass_mailing.unsubscribe_form"/>
        </t>
    </template>

    <template id="unsubscribe_form">
        <div id="o_mailing_portal_subscription"
             class="o_mailing_portal_body"
             t-att-data-blocklist-enabled="blocklist_enabled"
             t-att-data-blocklist-possible="blocklist_possible"
             t-att-data-document-id="document_id"
             t-att-data-feedback-enabled="feedback_enabled"
             t-att-data-feedback-readonly="feedback_readonly"
             t-att-data-hash-token="hash_token"
             t-att-data-last-action="last_action"
             t-att-data-email="email"
             t-att-data-email-valid="email_valid"
             t-att-data-is-blocklisted="is_blocklisted"
             t-att-data-mailing-id="mailing_id">
            <div class="o_container_small">
                <h1 class="o_page_header border-bottom-0 my-5 pt-4">Mailing Preferences</h1>
                <div id="o_mailing_subscription_info"
                         class="mb-5"
                         role="status">
                        <t t-if="unsubscribed or unsubscribed_name or unsubscribed_message">
                            <div id="o_mailing_unsubscribed_alert" class="alert alert-success d-flex align-items-center" role="alert">
                                <i class="fa fa-check-circle float-start me-3"/>
                                <span t-if="unsubscribed_name">You have successfully unsubscribed from <b t-out="unsubscribed_name"/>!</span>
                                <span t-elif="unsubscribed_message"><b t-out="unsubscribed_message"/></span>
                                <span t-else="">You have successfully unsubscribed from our mailing list!</span>
                            </div>
                        </t>
                        <div id="o_mailing_subscription_feedback"
                             t-att-class="'' if feedback_enabled else 'd-none'">
                            <form action="/mail/mailing/feedback" method="POST"
                                  class="mt-3">
                                <p>
                                    Please let us know why you updated your subscription.
                                </p>
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <fieldset>
                                    <div class="form-check"
                                         t-foreach="opt_out_reasons"
                                         t-as="opt_out_reason">
                                        <input class="form-check-input o_mailing_subscription_opt_out_reason"
                                               type="radio"
                                               name="opt_out_reason_id"
                                               t-att-id="'opt_out_reason_id' + str(opt_out_reason.id)"
                                               t-att-data-is-feedback="opt_out_reason.is_feedback"
                                               t-att-value="opt_out_reason.id"/>
                                        <label class="form-check-label"
                                               t-att-for="'opt_out_reason_id' + str(opt_out_reason.id)"
                                               t-out="opt_out_reason.name"/>
                                    </div>
                                </fieldset>
                                <textarea class="form-control d-none" name="feedback" cols="60" rows="3"></textarea>
                                <div class="d-flex align-items-center mt-2">
                                    <button type="submit" id="button_feedback"
                                            class="btn btn-primary text-start me-2">Send</button>
                                    <div id="o_mailing_subscription_feedback_info" class="d-none"/>
                                </div>
                            </form>
                        </div>
                    </div>

                <div id="o_mailing_subscription_form" class="mb-5">
                    <form action="/mailing/list/update" method="POST">
                        <h3>Your subscriptions</h3>
                        <div id="o_mailing_subscription_form_blocklisted"
                             t-att-class="'' if is_blocklisted else 'd-none'">
                            <p>
                                Your address <b t-out="email"/> is currently in our <strong>block list</strong>.
                                <t t-if="lists_optin_public">
                                    You will not receive any news from those mailing lists you are a member of:
                                </t>
                                <t t-else="">
                                    No mass mailing will be sent to it until you re-allow mailings.
                                </t>
                            </p>
                            <ul t-if="lists_optin_public" class="list-group mb-3">
                                <t t-foreach="lists_optin_public" t-as="mailing_list">
                                    <li class="list-group-item d-flex align-items-center">
                                        <strong t-esc="mailing_list.name"/>
                                    </li>
                                </t>
                            </ul>
                        </div>

                        <div id="o_mailing_subscription_form_manage"
                             t-att-class="'d-none' if is_blocklisted else ''">
                            <p>
                                Update your subscriptions for <b t-out="email"/>
                            </p>
                            <ul id="o_mailing_subscription_form_lists"
                                t-if="lists_optin_public + lists_optout_public + lists_public"
                                class="list-group">
                                <li t-foreach="lists_optin_public + lists_optout_public + lists_public"
                                    t-as="mailing_list"
                                    class="list-group-item d-flex align-items-center py-0 pe-0">
                                    <span class="ms-1 py-2" t-out="mailing_list.name"/>
                                    <span class="ms-auto mb-0 form-switch form-check">
                                        <label class="form-check-label px-3 py-2 d-flex o_mailing_subscription_form_list_toggle">
                                            <t t-if="mailing_list in lists_optin_public">
                                                On
                                            </t>
                                            <t t-else="">
                                                Off
                                            </t>
                                            <input class="form-check-input mailing_lists_checkboxes ms-3 mb-0"
                                                type="checkbox" role="switch"
                                                name="mailing_list_ids"
                                                t-att-id="'mailing_list_id' + str(mailing_list.id)"
                                                t-att-data-member="'1' if mailing_list in (lists_optin_public + lists_optout_public) else None"
                                                t-att-disabled="'disabled' if is_blocklisted else None"
                                                t-att-value="mailing_list.id"
                                                t-att-checked="'checked' if mailing_list in lists_optin_public else None"
                                                t-att-title="mailing_list.name"/>
                                        </label>
                                    </span>
                                </li>
                            </ul>
                            <p t-if="not lists_optin and not lists_optout and not lists_public">
                                You are not subscribed to any of our mailing list.
                            </p>
                        </div>
                        <div id="o_mailing_subscription_blocklist"
                             class="d-flex align-items-center mb-4 mt-3">
                            <div class="btn btn-link me-2 text-uppercase d-none"
                                 t-if="blocklist_enabled and blocklist_possible"
                                 id="button_blocklist_add">Exclude Me</div>
                            <div class="btn btn-link text-uppercase d-none"
                                 id="button_blocklist_remove">Allow Mailings</div>
                            <div id="o_mailing_subscription_update_info" class="d-none"/>
                        </div>
                    </form>
                </div>
                <div class="oe_structure oe_empty"/>
            </div>
            <div id="o_mailing_portal_subscription_editor" class="oe_structure oe_empty"/>
        </div>
    </template>
</odoo>
