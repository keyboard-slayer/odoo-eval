<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_self_order.ProductMainView">
        <div class="product_main_view d-flex flex-column dvh-100">
            <NavBar shadow="true" />
            <div class="bg-white d-flex flex-column pt-3 overflow-auto h-100">
                <div class="px-3">
                    <img t-if="props.product.has_image"
                        class="w-100 rounded-3"
                        style="max-height: 30vh; object-fit: cover;"
                        t-attf-src="/menu/get-image/{{ props.product.id }}/1920?unique={{props.product.write_date}}"
                        alt="Product image"/>
                    <div class="pt-3">
                        <h3 t-esc="props.product.name"
                            class="o_self_order_product_main_view_name"
                            />
                        <h4 class="text-primary"
                            t-esc="selfOrder.formatMonetary(props.product.price_info.display_price)"/>
                    </div>
                </div>
                <div t-if="props.product.description_sale"
                    class="o_self_order_main_desc px-3 pb-3 text-muted"
                    t-esc="props.product.description_sale"
                    />
                <div class="o_self_order_main_options px-3 py-4 border-bottom bg-100" t-if="selfOrder.ordering" >
                    <AttributeSelection product="product" options="{defaultAttr: true}" line="this.selfOrder.editedLine" />
                    <div t-foreach="props.product.pos_combo_ids or []" t-as="combo_id" t-key="combo_id" class="mb-3">
                        <t t-set="combo" t-value="selfOrder.comboByIds[combo_id]"/>
                        <h3 class="py-1" t-esc="combo.name"/>
                        <div t-foreach="combo.combo_line_ids" t-as="combo_line" t-key="combo_line.id" class="d-flex align-items-center form-control py-3">
                            <input type="radio" class="form-check-input my-1 me-2"
                                t-att-name="combo.name"
                                t-attf-id="{{ combo.name }}_{{ combo_line.product_id[1] }}"
                                t-att-value="combo_line.id"
                                t-model="state.selectedCombos[combo.id]" />
                            <label t-attf-for="{{ combo.name }}_{{ combo_line.product_id[1] }}" class="d-flex flex-grow-1">
                                <div class="" t-esc="selfOrder.productByIds[combo_line.product_id[0]].name"/>
                                <div class="ms-auto pe-3" t-if="combo_line.combo_price">
                                    + <t t-esc="selfOrder.formatMonetary(combo_line.combo_price)" />
                                </div>
                            </label>
                        </div>
                    </div>

                    <div t-if="selfOrder.ordering and (!disableAttributes || state.customer_note)">
                        <label class="form-label fw-bold" for="note">Add a note:</label>
                        <textarea class="form-control rounded bg-white" id="note" type="textarea" rows="1" placeholder="No onions please" t-model="state.customer_note" t-att-disabled="disableAttributes" />
                    </div>
                </div>
                <div t-if="selfOrder.ordering" class="d-flex flex-column align-items-center w-100 p-3 bg-white shadow-lg" style="z-index:1">
                    <div class="o_self_order_incr_button btn-group text-center border-light mb-1" role="group" aria-label="Quantity select">
                        <button type="button"
                            t-on-click = "() => this.changeQuantity(false)"
                            class="btn btn-light rounded-circle"> - </button>
                        <div class="d-flex align-items-center px-4 fw-bold" t-esc="state.qty + state.cartQty"/>
                        <button type="button"
                            t-on-click = "() => this.changeQuantity(true)"
                            class="btn btn-light rounded-circle"> + </button>
                    </div>
                    <t t-set="button_disabled" t-value="!this.selfOrder.editedLine and state.qty + state.cartQty === 0" />
                    <button
                        t-on-click="addToCart"
                        t-attf-class="{{ button_disabled ? 'disabled' : '' }} o_self_order_main_button btn btn-primary w-100 px-2 py-3 mt-2 rounded">
                        <t t-if="this.selfOrder.editedLine and state.qty + state.cartQty > 0">
                            Update Cart
                        </t>
                        <t t-elif="this.selfOrder.editedLine">
                            Remove from Cart
                        </t>
                        <t t-else="">
                            Add to Cart
                        </t>
                    </button>
                </div>
            </div>
        </div>
    </t>
</templates>
