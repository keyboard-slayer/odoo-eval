<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_self_order.OrderCart" owl="1">
        <KioskTemplate hasFixedContent="true" hideFooterBorder="true">
            <t t-set-slot="header">
                <div class="py-4 bg-view text-center border-bottom" t-ref="orderHeader">
                    <h1 class="mb-0 fw-bolder">Verify your Order</h1>
                </div>
            </t>
            <t t-set-slot="content">
                <div class="o_kiosk-order-cart position-relative d-flex flex-column justify-content-between h-100">
                    <div class="order-content flex-grow-1 px-3 py-4 overflow-auto" t-ref="orderContent" t-on-scroll="_orderListScroll">
                        <t t-foreach="lines" t-as="line" t-key="line.uuid">
                            <div t-if="!line.combo_parent_uuid" class="d-flex align-items-start justify-content-between w-100 gap-3 py-3 px-3 mb-2 rounded border bg-view">
                                <t t-set="childLines" t-value="getChildLines(line)"/>
                                <t t-set="product" t-value="this.selfOrder.productByIds[line.product_id]"/>
                                <img
                                    class="o_self_order_item_card_image ratio ratio-1x1 w-auto h-100 rounded bg-view"
                                    t-attf-src="/menu/get-image/{{ product.id }}/128?unique={{product.write_date}}"
                                    alt="Product image"
                                    loading="lazy"
                                    onerror="this.remove()" />
                                <div class="product-wrapper d-flex flex-grow-1 align-self-stretch gap-3">
                                    <div class="product-info d-flex flex-column flex-grow-1">
                                        <div class="fs-2 fw-bolder"><span t-esc="line.full_product_name"/></div>

                                        <ul t-if="line.attributes.length">
                                            <li t-foreach="line.attributes" t-as="attribute" t-key="attribute.name" class="text-muted">
                                                <span t-esc="attribute.name" />: <span t-esc="attribute.value" />
                                            </li>
                                        </ul>

                                        <div t-foreach="childLines" t-as="cline" t-key="cline.uuid" class="text-muted">
                                            - <span t-esc="cline.full_product_name" /> <span t-if="cline.price_subtotal_incl">(<t t-esc="selfOrder.formatMonetary(cline.price_subtotal_incl)"/>)</span>
                                            <div class="product-info d-flex flex-column flex-grow-1 ms-3">
                                                <div t-foreach="cline.attributes" t-as="attribute" t-key="attribute.name">
                                                    - <span t-esc="attribute.name" /> : <span t-esc="attribute.value" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="line-price d-flex flex-column align-items-end justify-content-between align-self-stretch">
                                        <span class="o_kiosk_tab_numbers fs-3 mb-2 fw-bolder" t-esc="selfOrder.formatMonetary(getPrice(line))"/>
                                        <div class="o_self_order_incr_button d-flex flex-row text-center border-light mb-1">
                                            <button type="button"
                                                t-on-click = "() => this.changeQuantity(line, false)"
                                                t-attf-class="btn {{ line.qty === 1 ? 'btn-danger' : 'btn-secondary'}} rounded fs-2 py-2">
                                                <i t-if="line.qty === 1" class="fa fa-trash" aria-hidden="true"></i>
                                                <span t-else=""> - </span>
                                            </button>
                                            <div class="o_kiosk_tab_numbers d-flex align-items-center px-3 fs-2 fw-bold" t-esc="line.qty"/>
                                            <button type="button"
                                                t-on-click = "() => this.changeQuantity(line, true)"
                                                class="btn btn-secondary fs-2 py-2 rounded" > + </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                    <div class="order-price absolute-content w-100">
                        <div class="absolute-content-price d-flex flex-column justify-content-center pt-4 px-4 pb-2 border-top bg-view text-end lh-sm">
                            <p class="o_kiosk_tab_numbers mb-0 fs-1 fw-bolder">Total: <t t-esc="selfOrder.formatMonetary(selfOrder.currentOrder.amount_total)" /></p>
                            <p class="o_kiosk_tab_numbers mb-0 fs-2 text-muted">Taxes: <t t-esc="selfOrder.formatMonetary(selfOrder.currentOrder.amount_tax)" /></p>
                        </div>
                    </div>
                </div>
            </t>
            <t t-set-slot="footer">
                <div class="d-flex flex-row w-100 align-items-center justify-content-between gap-3">
                    <button class="btn btn-secondary btn-lg text-uppercase" t-on-click="backToMenu">Back to Menu</button>
                    <button t-attf-class="{{ selfOrder.currentOrder.lines.length === 0 ? 'disabled' : '' }} btn-lg btn btn-primary text-uppercase" t-on-click="pay">Pay <t t-if="selfOrder.pos_payment_methods.length === 0">at counter</t></button>
                </div>
            </t>
        </KioskTemplate>
    </t>
</templates>
