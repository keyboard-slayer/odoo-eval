<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_self_order.ProductList" owl="1">
        <t t-set="categories" t-value="Array.from(selfOrder.categoryList)" />
        <KioskTemplate headerHeight="selfOrder.kiosk_image_brand ? 8 : 0" contentHeight="selfOrder.kiosk_image_brand ? 82 : 90" footerHeight="10">
            <t t-set-slot="header">
                <div class="header-image h-100" t-attf-style="background-image: url('data:image/png;base64,{{selfOrder.kiosk_image_brand}}')" />
            </t>
            <t t-set-slot="content">
                <div class="o_kiosk_product_list h-100 d-flex flex-column">
                    <div class="category-list d-flex flex-column flex-wrap gap-3 align-content-start p-3 shadow-sm bg-view z-index-1" t-ref="categoryList">
                        <button
                            t-foreach="categories"
                            t-as="category"
                            t-key="category.id"
                            t-ref="category_{{category.name}}"
                            t-attf-class="{{selfOrder.currentCategory === category.name ? 'border-2 border-primary' : ''}} btn btn-light d-flex flex-column align-items-center justify-content-center category-item h-100 border p-2 overflow-hidden"
                            t-on-click="() => this.categoryClicked(category.name)">
                            <img t-if="category.has_image"
                                class="rounded w-100 h-75 ratio ratio-1x1"
                                t-attf-src="/kiosk/get-category-image/{{ category.id }}"
                                alt="Product image"
                                loading="lazy"
                                onerror="this.remove()" />
                            <span class="w-100 fs-3 text-truncate" t-esc="category.name" />
                        </button>
                    </div>
                    <div class="product-list pb-4" t-ref="productsList">
                        <div>
                            <h2 class="pt-5 pb-1 px-4 m-0 fs-1 " t-esc="selfOrder.currentCategory" />
                            <div class="product-list-category d-grid gap-3 p-3">
                                <t t-foreach="productCategory" t-as="product" t-key="product.id">
                                    <ProductCard product="product" currentProductCard="product.id === selfOrder.lastEditedProductId and currentProductCard" />
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </t>

            <t t-set-slot="footer">
                <div class="d-flex flex-row w-100 h-100 gap-3">
                    <button class="btn btn-secondary h-100 w-100 p-0 m-0 fs-2 text-uppercase" t-on-click="cancelOrder">CANCEL ORDER</button>
                    <button t-attf-class="{{ selfOrder.currentOrder.lines.length === 0 ? 'd-none' : '' }} cart btn btn-primary h-100 w-100 d-flex flex-column justify-content-center align-items-center p-0 m-0 fs-2 text-uppercase" t-on-click="review">
                        Review Order
                        <span t-attf-class="total-price {{ selfOrder.currentOrder.lines.length === 0 ? 'd-none' : '' }} fs-4">
                            Total: <t t-esc="selfOrder.formatMonetary(selfOrder.currentOrder.amount_total)" />
                        </span>
                    </button>
                </div>
            </t>
        </KioskTemplate>
    </t>
</templates>
