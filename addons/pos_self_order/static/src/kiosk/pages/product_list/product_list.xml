<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_self_order.ProductList" owl="1">
        <t t-set="categories" t-value="Array.from(selfOrder.categoryList)" />
        <KioskTemplate headerHeight="selfOrder.kiosk_image_brand ? 8 : 0" contentHeight="selfOrder.kiosk_image_brand ? 82 : 90" footerHeight="10">
            <t t-set-slot="header">
                <div class="header-image h-100" t-attf-style="background-image: url('data:image/png;base64,{{selfOrder.kiosk_image_brand}}')" />
            </t>
            <t t-set-slot="content">
                <div class="o_kiosk_product_list h-100 d-flex flex-column">
                    <div class="category-list d-flex flex-column flex-wrap gap-3 align-content-start p-3 shadow-sm bg-view z-index-1" t-ref="categoryList">
                        <button
                            t-foreach="categories"
                            t-as="category"
                            t-key="category.id"
                            t-ref="category_{{category.name}}"
                            t-attf-class="{{selfOrder.currentCategory === category.name ? 'border-2 border-primary' : ''}} btn btn-light d-flex flex-column align-items-center justify-content-center category-item h-100 border p-2 overflow-hidden"
                            t-on-click="() => this.categoryClicked(category.name)">
                            <img t-if="category.has_image"
                                class="rounded w-100 h-75 ratio ratio-1x1"
                                t-attf-src="/kiosk/get-category-image/{{ category.id }}"
                                alt="Product image"
                                loading="lazy"
                                onerror="this.remove()" />
                            <span class="w-100 fs-3 text-truncate" t-esc="category.name" />
                        </button>
                    </div>
                    <div class="product-list pb-4" t-ref="productsList">
                        <div>
                            <h2 class="pt-5 pb-1 px-4 m-0 fs-1 " t-esc="selfOrder.currentCategory" />
                            <div class="product-list-category d-grid gap-3 p-3">
                                <t t-foreach="productCategory" t-as="product" t-key="product.id">
                                    <ProductCard product="product" currentProductCard="product.id === selfOrder.lastEditedProductId and currentProductCard" />
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </t>

            <t t-set-slot="footer">
                <div class="d-flex flex-row w-100 h-100 gap-3">
                    <button class="btn btn-secondary h-100 px-5 m-0 fs-2 text-uppercase" t-on-click="cancelOrder">CANCEL</button>
                    <div class="footer-information d-flex flex-column flex-grow-1 justify-content-center px-4 m-0 rounded border">
                        <h3 class="fw-bolder m-0">Your Order</h3>
                        <div class="footer-information-content d-flex align-items-center">
                            <span class="info-number position-relative d-flex me-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="47" fill="none">
                                    <path fill="var(--companyColor)" d="m35.289 26.702.703 18.887c.04.371-.067.702-.322.994a1.25 1.25 0 0 1-.963.417H1.293c-.388 0-.71-.14-.964-.417a1.25 1.25 0 0 1-.32-.994L.71 26.702h34.578Zm-1.867-15.398 1.726 15.398H.852l1.726-15.398c.04-.317.181-.586.422-.804.241-.219.529-.328.864-.328h5.14v2.543c0 .702.251 1.301.753 1.798a2.49 2.49 0 0 0 1.817.745 2.49 2.49 0 0 0 1.818-.745 2.437 2.437 0 0 0 .753-1.798v-2.543h7.71v2.543c0 .702.251 1.301.753 1.798a2.49 2.49 0 0 0 1.818.745 2.49 2.49 0 0 0 1.817-.745 2.437 2.437 0 0 0 .753-1.798v-2.543h5.14c.335 0 .623.11.864.328.24.218.381.487.422.805ZM25.71 7.63v5.086c0 .344-.127.642-.382.894a1.242 1.242 0 0 1-.903.377c-.348 0-.65-.125-.904-.377a1.216 1.216 0 0 1-.381-.894V7.629c0-1.404-.502-2.603-1.506-3.596-1.005-.993-2.216-1.49-3.635-1.49-1.419 0-2.63.497-3.634 1.49-1.005.993-1.506 2.192-1.506 3.596v5.086c0 .344-.128.642-.382.894a1.242 1.242 0 0 1-.904.377c-.348 0-.649-.125-.903-.377a1.216 1.216 0 0 1-.382-.894V7.629c0-2.106.753-3.904 2.26-5.394C14.053.745 15.87 0 18 0c2.128 0 3.946.745 5.452 2.235 1.506 1.49 2.259 3.288 2.259 5.394Z"/>
                                </svg>
                                <span class="position-absolute position-absolute top-50 start-50 translate-middle fs-3 fw-bolder pt-3 text-white">
                                    <t t-esc="selfOrder.currentOrder.lines.length"/>
                                </span>
                            </span>
                            <span class="total-price fs-1 fw-bolder mt-1"><t t-esc="selfOrder.formatMonetary(selfOrder.currentOrder.amount_total)" /></span>
                        </div>
                    </div>
                    <button t-attf-class="cart btn btn-primary h-100 d-flex flex-column justify-content-center align-items-center m-0 fs-2 text-uppercase" t-on-click="review">
                        PAY
                    </button>
                </div>
            </t>
        </KioskTemplate>
    </t>
</templates>
