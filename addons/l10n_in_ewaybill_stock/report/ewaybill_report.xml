<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_ewaybill">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.internal_layout">
                        <div class="page">
                            <style>
                                th, td {
                                  padding: 5px;
                                  border: none;
                                }
                            </style>
                            <div class="row">
                                <div class="col-4">
                                    <img t-att-src="image_data_uri(doc.company_id.logo)" class="img-fluid" style="width: 100px; height: 100px;" alt="Company Logo"/>
                                </div>
                                <div class="col-4 text-center">
                                    <h3>e-Way Bill</h3>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <t t-if="doc.name != False">
                                        <img t-att-src="'/report/barcode/QR/' + str(doc.name) + '/' + str(doc.company_id.vat) + '/' + str(doc.ewaybill_date)" style="width: 100px; height: 100px;" alt="Barcode"/>
                                    </t>
                                </div>
                            </div>
                            <hr/>
                            <t t-set="generate_json" t-value="doc._ewaybill_generate_direct_json()"/>
                            <h4>1. E-WAY BILL Details</h4>
                            <div class="row">
                                <div class="col-3">
                                    eWay Bill No: <span t-esc="doc.name"/>
                                </div>
                                <div class="col-3">
                                    Generated Date: <span t-esc="doc.ewaybill_date"/>
                                </div>
                                <div class="col-3">
                                    Generated By: <span t-esc="doc.company_id.vat"/>
                                </div>
                                <t t-if="doc.name != False">
                                    <div class="col-3">
                                            Valid Upto: <span t-esc="doc.ewaybill_expiry_date"/>
                                        <t t-if="doc.mode == '1'">
                                            (Vehicle Type is <span t-esc="dict(doc._fields['vehicle_type'].selection).get(doc.vehicle_type)" /> )                                        
                                        </t>
                                    </div>
                                </t>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    Mode: <span t-esc="dict(doc._fields['mode']._description_selection
(doc.env)).get(doc.mode, '')"/>
                                </div>
                                <div class="col-3">
                                    Approx Distance: <span t-esc="doc.distance"/> km
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    Type: <span t-esc="doc.supply_type"/> <span t-esc="doc.type_id.sub_type"/> <span t-esc="doc.type_description"/>
                                </div>
                                <div class="col-6">
                                    Document Details: <t><span t-esc="doc.type_id.name"/> - <span t-esc="doc.stock_picking_id.name"/> - <span t-esc="doc.ewaybill_date"/></t>
                                </div>
                                <div class="col-3">
                                    Transaction Type:
                                        <t t-if="generate_json['transactionType'] == 2">
                                            <span>Bill To - Ship To</span>
                                        </t>
                                        <t t-elif="generate_json['transactionType'] == 3">
                                            <span>Bill From - Dispatch From</span>
                                        </t>
                                        <t t-elif="generate_json['transactionType'] == 4">
                                            <span>Combination of 2 and 3</span>
                                        </t>
                                        <t t-else="">
                                            <span>Regular</span>
                                        </t>
                                </div>
                            </div>
                            <hr/>

                            <h4>2. Address Details</h4>
                            <table style="width: 100%; border-color: white;">
                                <tr>
                                    <td>
                                        From
                                    </td>
                                    <td/>
                                    <td>
                                        To
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid black;">
                                            GSTIN: <t t-esc="generate_json['fromGstin']"/><br/>
                                            <t t-esc="doc.partner_bill_from_id.name"/><br/>
                                            <t t-esc="doc.partner_bill_from_id.state_id.name"/><br/>
                                            <br/>
                                            ::Dispatch From::
                                            <div t-field="doc.partner_ship_from_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/>
                                    </td>
                                    <td/>
                                    <td style="border:1px solid black;">
                                            GSTIN: <t t-esc="generate_json['toGstin']"/><br/>
                                            <t t-esc="doc.partner_bill_to_id.name"/><br/>
                                            <t t-esc="doc.partner_bill_to_id.state_id.name"/><br/>
                                            <br/>
                                            ::Ship To::
                                            <div t-field="doc.partner_ship_to_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/>
                                    </td>
                                </tr>
                            </table>
                            <hr/>

                            <h4>3. Goods Details</h4>
                            <t t-call="l10n_in_ewaybill_stock.report_ewaybill_goods"/><br/>
                            <div class="row">
                                <div class="col-3">
                                    Total Taxable Amount <span t-esc="generate_json['totalValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                                <div class="col-3">
                                    CGST Amount <span t-esc="generate_json['cgstValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                                <div class="col-3">
                                    SGST Amount <span t-esc="generate_json['sgstValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                                <div class="col-3">
                                    IGST Amount <span t-esc="generate_json['igstValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    CESS Amount <span t-esc="generate_json['cessValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                                <div class="col-3">
                                    CESS Non.Advol Amt <span t-esc="generate_json['cessNonAdvolValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                                <div class="col-3">
                                    Other Amt <span t-esc="generate_json['otherValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                                <div class="col-3">
                                    Total Inv. Amt <span t-esc="generate_json['totInvValue']" t-options='{"widget": "monetary", "display_currency": doc.company_currency_id}'/>
                                </div>
                            </div>
                            <hr/>

                            <h4>4. Transportation Details</h4>
                            <div class="row">
                                <div class="col-6">
                                    Transporter ID and Name: <span t-esc="doc.transporter_id.vat"/> &amp; <span t-esc="doc.transporter_id.name"/>
                                </div>
                                <div class="col-6">
                                    Transporter Doc and Date: <span t-esc="doc.transportation_doc_no"/> &amp; <span t-esc="doc.transportation_doc_date"/>
                                </div>
                            </div>
                            <hr/>

                            <h4>5. Vehicle Details</h4>
                            <t t-call="l10n_in_ewaybill_stock.report_ewaybill_vehicles"/><br/>
                            <div style="text-align: center;">
                                <div>
                                    <t t-if="doc.name != False">
                                        <img t-att-src="'/report/barcode/Code128/' + doc.name" style="width:250px;height:35px;" alt="Barcode"/>
                                    </t>
                                </div>
                                <div>
                                    <span t-esc="doc.name"/>
                                </div>
                            </div>
                            <hr/>
                        </div>
                    </t>
               </t> 
            </t>
        </template>

        <template id="report_ewaybill_goods">
            <table style="width: 100%; border:1px solid black;">
                <thead>
                    <tr style="border:1px solid black;">
                        <th>HSN Code</th>
                        <th>Product Description</th>
                        <th>Quantity</th>
                        <th>Taxable Amount Rs.</th>
                        <th>Tax Rate (C+S+I+Cess+Cess Non Advol)</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="items" t-value="generate_json['itemList']"/>
                    <tr t-foreach="items" t-as="item" style="border:1px solid black;">
                        <td>
                            <t t-esc="item['hsnCode']"/>
                        </td>
                        <td>
                            <t t-esc="item['productDesc']"/>
                        </td>
                        <td>    
                            <t t-esc="item['quantity']"/> <t t-esc="item['qtyUnit']"/>
                        </td>
                        <td>    
                            <t t-esc="item['taxableAmount']"/>
                        </td>
                        <td>
                            <t t-esc="
                                (str(round(item['cgstRate'], 2)) if 'cgstRate' in item else 'NE') + ' + ' +
                                (str(round(item['sgstRate'], 2)) if 'sgstRate' in item else 'NE') + ' + ' +
                                (str(round(item['igstRate'], 2)) if 'igstRate' in item else 'NE') + ' + ' +
                                (str(round(item['cessRate'], 2)) if 'cessRate' in item else 'NE') + ' + ' +
                                (str(round(item['cessNonadvol'], 2)) if 'cessNonadvol' in item else 'NE')
                            "/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </template>

        <template id="report_ewaybill_vehicles">
            <table>
                <thead style="border-bottom:1px solid black;">
                    <tr>
                        <th>Mode</th>
                        <th>Vehicle / Trans Doc No and Dt.</th>
                        <th>From</th>
                        <th>Entered Date</th>
                        <th>Entered By</th>
                        <th>CEWB No.(if any)</th>
                        <th>Multi Veh.Info(if any)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <t t-esc="dict(doc._fields['mode']._description_selection
(doc.env)).get(doc.mode, '')"/>
                        </td>
                        <td>
                            <t t-if="doc.vehicle_no">
                                <t t-esc="doc.vehicle_no"/>
                            </t>
                            <t t-else="">
                                <t t-esc="doc.transportation_doc_no"/> (<t t-esc="doc.transportation_doc_date"/>)
                            </t>
                        </td>
                        <td>    
                            <t t-esc="generate_json['fromPlace']"/>
                        </td>
                        <td>    
                            <t t-esc="doc.ewaybill_date"/>
                        </td>
                        <td>
                            <t t-esc="doc.company_id.vat"/>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
        </template>

    </data>
</odoo>
