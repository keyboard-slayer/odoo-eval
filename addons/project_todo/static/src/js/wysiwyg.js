/** @odoo-module **/

import { Wysiwyg } from '@web_editor/js/wysiwyg/wysiwyg';
import { _t } from "@web/core/l10n/translation";
import { patch } from "@web/core/utils/patch";
import { ChatGPTPromptDialog } from '@web_editor/js/wysiwyg/widgets/chatgpt_prompt_dialog';
import { preserveCursor } from '../../../../web_editor/static/src/js/editor/odoo-editor/src/OdooEditor';

patch(Wysiwyg.prototype, {
    _getPowerboxOptions() {
        const options = super._getPowerboxOptions();
        options.commands.push({
            category: _t('AI Tools'),
            name: _t("Essay"),
            description: _t("Write an essay"),
            fontawesome: 'fa-edit',
            priority: 2,
            callback: () => {
                // callback function gets called when hitting enter
                // OR clicking on the command from powerbox.
                this.openDialog();
            }
        })
        return options;
    },
    openDialog() {
        const restore = preserveCursor(this.odooEditor.document);
        this.env.services.dialog.add(ChatGPTPromptDialog, {
            initialPrompt: _t('Write essay on '),
            insert: (content) => {
                // Insert content to the document
                // generated by chatgpt.
                this.odooEditor.execCommand('insert', content);
            }
        }, {
            onClose: restore // Restore cursor when closing the dialog.
        });
    }
})