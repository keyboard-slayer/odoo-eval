<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="l10n_ro_template_etransport">
        <eTransport
            xmlns="mfp:anaf:dgti:eTransport:declaratie:v2"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="mfp:anaf:dgti:eTransport:declaratie:v2"
            t-att-codDeclarant="document.l10n_ro_edi_etransport_company_id.vat.upper().replace('RO', '')"
            t-att-refDeclarant="declarant_ref">

            <notificare t-att-codTipOperatiune="document.l10n_ro_edi_etransport_operation_type_id.code">
                <corectie t-if="send_type == 'amend'" t-att-uit="document.l10n_ro_edi_etransport_uit"/>

                <t t-foreach="document.l10n_ro_edi_etransport_move_ids" t-as="move">
                    <t t-set="product" t-value="move.product_id"/>

                    <bunuriTransportate
                            t-att-codScopOperatiune="document.l10n_ro_edi_etransport_operation_scope_id.code"
                            t-att-codTarifar="product.intrastat_code_id.code or '00000000'"
                            t-att-denumireMarfa="product.name"
                            t-att-cantitate="move.product_qty"
                            t-att-codUnitateMasura="move.product_uom._get_unece_code()"
                            t-att-greutateNeta="move.weight"
                            t-att-greutateBruta="move.weight + sum(line.result_package_id.shipping_weight for line in move.move_line_ids if line.result_package_id)"
                            t-att-valoareLeiFaraTva="product.list_price"/>
                </t>

                <partenerComercial
                        t-att-codTara="partner.country_code"
                        t-att-denumire="partner.name"
                        t-att-cod="partner.vat.upper().replace('RO', '') if partner.vat else 'PF' if document.l10n_ro_edi_etransport_operation_type_id.code == '30' else None"/>

                <dateTransport
                        t-att-nrVehicul="vehicle_number"
                        t-att-nrRemorca1="trailer1"
                        t-att-nrRemorca2="trailer2"
                        t-att-codTaraOrgTransport="transport_partner.country_code"
                        t-att-codOrgTransport="transport_partner.vat.upper().replace('RO', '')"
                        t-att-denumireOrgTransport="transport_partner.name"
                        t-att-dataTransport="scheduled_date"/>

                <t t-if="document.l10n_ro_edi_etransport_start_loc_value == 'location'">
                    <locStartTraseuRutier>
                        <locatie
                                t-att-codJudet="STATE_CODES[document.l10n_ro_edi_etransport_start_state_id.code]"
                                t-att-denumireLocalitate="document.l10n_ro_edi_etransport_start_city"
                                t-att-denumireStrada="document.l10n_ro_edi_etransport_start_street"
                                t-att-codPostal="document.l10n_ro_edi_etransport_start_zip"
                                t-att-alteInfo="document.l10n_ro_edi_etransport_start_other_info"/>
                    </locStartTraseuRutier>
                </t>
                <t t-elif="document.l10n_ro_edi_etransport_start_loc_value == 'bcp'">
                    <locStartTraseuRutier t-att-codPtf="document.l10n_ro_edi_etransport_start_bcp"/>
                </t>
                <t t-elif="document.l10n_ro_edi_etransport_start_loc_value == 'customs'">
                    <locStartTraseuRutier t-att-codBirouVamal="document.l10n_ro_edi_etransport_start_customs_office.code"/>
                </t>

                <t t-if="document.l10n_ro_edi_etransport_end_loc_value == 'location'">
                    <locFinalTraseuRutier>
                        <locatie
                                t-att-codJudet="STATE_CODES[document.l10n_ro_edi_etransport_end_state_id.code]"
                                t-att-denumireLocalitate="document.l10n_ro_edi_etransport_end_city"
                                t-att-denumireStrada="document.l10n_ro_edi_etransport_end_street"
                                t-att-codPostal="document.l10n_ro_edi_etransport_end_zip"
                                t-att-alteInfo="document.l10n_ro_edi_etransport_end_other_info"/>
                    </locFinalTraseuRutier>
                </t>
                <t t-elif="document.l10n_ro_edi_etransport_end_loc_value == 'bcp'">
                    <locFinalTraseuRutier t-att-codPtf="document.l10n_ro_edi_etransport_end_bcp"/>
                </t>
                <t t-elif="document.l10n_ro_edi_etransport_end_loc_value == 'customs'">
                    <locFinalTraseuRutier t-att-codBirouVamal="document.l10n_ro_edi_etransport_end_customs_office.code"/>
                </t>

                <documenteTransport
                        tipDocument="30"
                        t-att-dataDocument="scheduled_date"
                        t-att-numarDocument="declarant_ref"
                        t-att-observatii="document.l10n_ro_edi_etransport_remarks"/>
            </notificare>
        </eTransport>
    </template>
</odoo>
