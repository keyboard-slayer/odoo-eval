<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="web.SearchBarMenu" owl="1">
        <Dropdown togglerClass="'o_searchview_dropdown_toggler d-print-none btn btn-secondary o-no-caret border-start h-100'"
                  menuClass="'d-flex'"
                  position="'bottom-end'">
            <t t-set-slot="toggler" t-slot-scope="scope">
                <i class="fa" t-att-class="{'fa-caret-down': !scope.open, 'fa-caret-up': scope.open}" aria-hidden="true"/>
            </t>
            <!-- Filter -->
            <div class="o_dropdown_container o_filter_menu py-3">
                <div class="px-3 fs-5 mb-2">
                    <i class="me-2 text-primary" t-att-class="facet_icons.filter"/>
                    <span class="o_dropdown_title">Filters</span>
                </div>
                <t t-set="currentGroup" t-value="null"/>
                <t t-foreach="filterItems" t-as="item" t-key="item.id">
                    <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                        <div class="dropdown-divider" role="separator"/>
                    </t>
                    <t t-if="item.options">
                        <Dropdown togglerClass="'o_menu_item' + (item.isActive ? ' selected' : '')">
                            <t t-set-slot="toggler">
                                <t t-esc="item.description"/>
                            </t>
                            <t t-set="subGroup" t-value="null"/>
                            <t t-foreach="item.options" t-as="option" t-key="option.id">
                                <t t-if="subGroup !== null and subGroup !== option.groupNumber">
                                    <div class="dropdown-divider" role="separator"/>
                                </t>
                                <SearchDropdownItem class="{ o_item_option: true, selected: option.isActive }"
                                                    t-esc="option.description"
                                                    checked="option.isActive"
                                                    parentClosingMode="'none'"
                                                    onSelected="() => this.onFilterSelected({ itemId: item.id, optionId: option.id })"
                                />
                                <t t-set="subGroup" t-value="option.groupNumber"/>
                            </t>
                        </Dropdown>
                    </t>
                    <t t-else="">
                        <SearchDropdownItem class="{ o_menu_item: true, selected: item.isActive }"
                                            checked="item.isActive"
                                            parentClosingMode="'none'"
                                            t-esc="item.description"
                                            onSelected="() => this.onFilterSelected({ itemId: item.id })"
                        />
                    </t>
                    <t t-set="currentGroup" t-value="item.groupNumber"/>
                </t>
                <t t-if="filterItems.length">
                    <div role="separator" class="dropdown-divider"/>
                </t>
                <CustomFilterItem/>
            </div>
            <!-- GroupBy -->
            <div class="o_dropdown_container o_group_by_menu py-3 border-start">
                <div class="px-3 fs-5 mb-2">
                    <i class="me-2 text-action" t-att-class="facet_icons.groupBy"/>
                    <span class="o_dropdown_title">Group By</span>
                </div>
                <t t-set="currentGroup" t-value="null"/>
                <t t-foreach="groupByItems" t-as="item" t-key="item.id">
                    <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                        <div class="dropdown-divider" role="separator"/>
                    </t>
                    <t t-if="item.options">
                        <Dropdown togglerClass="'o_menu_item' + (item.isActive ? ' selected' : '')">
                            <t t-set-slot="toggler">
                                <t t-esc="item.description"/>
                            </t>
                            <t t-set="subGroup" t-value="null"/>
                            <t t-foreach="item.options" t-as="option" t-key="option.id">
                                <t t-if="subGroup !== null and subGroup !== option.groupNumber">
                                    <div class="dropdown-divider" role="separator"/>
                                </t>
                                <SearchDropdownItem class="{ o_item_option: true, selected: option.isActive }"
                                                    checked="option.isActive ? true : false"
                                                    parentClosingMode="'none'"
                                                    t-esc="option.description"
                                                    onSelected="() => this.onGroupBySelected({ itemId: item.id, optionId: option.id})"
                                />
                                <t t-set="subGroup" t-value="option.groupNumber"/>
                            </t>
                        </Dropdown>
                    </t>
                    <t t-else="">
                        <SearchDropdownItem class="{ o_menu_item: true, selected: item.isActive }"
                                            checked="item.isActive"
                                            parentClosingMode="'none'"
                                            t-esc="item.description"
                                            onSelected="() => this.onGroupBySelected({ itemId: item.id })"
                        />
                    </t>
                    <t t-set="currentGroup" t-value="item.groupNumber"/>
                </t>
                <t t-if="!hideCustomGroupBy and fields.length">
                    <div t-if="groupByItems.length" role="separator" class="dropdown-divider"/>
                    <CustomGroupByItem fields="fields" onAddCustomGroup.bind="onAddCustomGroup"/>
                </t>
            </div>
            <!-- Comparison -->
            <div class="o_dropdown_container o_comparison_menu py-3 border-start" t-if="showComparisonMenu">
                <div class="px-3 fs-5 mb-2">
                    <i class="me-2 text-danger" t-att-class="facet_icons.comparison"/>
                    <span class="o_dropdown_title">Comparison</span>
                </div>
                <t t-foreach="comparisonItems" t-as="item" t-key="item.id">
                    <SearchDropdownItem class="{ o_menu_item: true, selected: item.isActive }"
                                        checked="item.isActive"
                                        parentClosingMode="'none'"
                                        t-esc="item.description"
                                        onSelected="() => this.onComparisonSelected(item.id)"
                    />
                </t>
            </div>
            <!-- Favorite -->
            <div class="o_dropdown_container o_favorite_menu py-3 border-start">
                <div class="px-3 fs-5 mb-2">
                    <i class="me-2 text-favourite" t-att-class="facet_icons.favorite"/>
                    <span class="o_dropdown_title">Favorites</span>
                </div>
                <t t-set="currentGroup" t-value="null"/>
                <t t-foreach="favoriteItems" t-as="item" t-key="item.id or item.key">
                    <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                        <div role="separator" class="dropdown-divider"/>
                    </t>
                    <t t-if="item.type ==='favorite'">
                        <SearchDropdownItem class="{ o_menu_item: true, selected: item.isActive }"
                                            checked="item.isActive"
                                            parentClosingMode="'none'"
                                            onSelected="() => this.onFavoriteSelected(item.id)"
                        >
                            <span class="d-flex p-0 align-items-center justify-content-between">
                                <t t-esc="item.description"/>
                                <i class="ms-1 o_icon_right fa fa-trash-o"
                                   title="Delete item"
                                   t-on-click.stop="() => this.openConfirmationDialog(item.id)"
                                />
                            </span>
                        </SearchDropdownItem>
                    </t>
                    <t t-else="">
                        <t t-component="item.Component"/>
                    </t>
                    <t t-set="currentGroup" t-value="item.groupNumber"/>
                </t>
            </div>
        </Dropdown>
    </t>

</templates>
