///
/// This file regroups the CSS rules made to fix/extend bootstrap in the backend
/// ==============================================================================


// Buttons
// ============================================================================
// Generating bootstrap color buttons was disabled (see import_bootstrap.scss).
// We do it ourself here generating each btn design type individually.

// 1. Render buttons defined in '$o-btns-custom' and '$o-btns-outline-custom'
//    maps.
@each $-name, $-value in $o-btns-custom {
    .btn-#{$-name} {
        @include button-variant(
            o-safe-get($-value, background),
            o-safe-get($-value, border),
            o-safe-get($-value, color),
            o-safe-get($-value, hover-background),
            o-safe-get($-value, hover-border),
            o-safe-get($-value, hover-color),
            o-safe-get($-value, active-background),
            o-safe-get($-value, active-border),
            o-safe-get($-value, active-color),
            // Handle btn-text exception specifically
            $disabled-color: if(alpha(o-safe-get($-value, background)) == 0, $o-main-color-muted, color-contrast(o-safe-get($-value, background))),
        );
    }
}

@each $-name, $-value in $o-btns-outline-custom {
    .btn-outline-#{$-name} {
        @include button-variant(
            o-safe-get($-value, background),
            o-safe-get($-value, border),
            o-safe-get($-value, color),
            o-safe-get($-value, hover-background),
            o-safe-get($-value, hover-border),
            o-safe-get($-value, hover-color),
            o-safe-get($-value, active-background),
            o-safe-get($-value, active-border),
            o-safe-get($-value, active-color),
        );
    }
}

// 2. Render '$theme-colors' buttons excluding the ones already generated
//    using the custom maps.
@each $-name, $-color in $theme-colors {
    @if (not map-get($o-btns-custom, $-name)) {
        .btn-#{$-name} {
            @include button-variant($-color, $-color);
        }
    }
    @if (not map-get($o-btns-outline-custom, $-name)) {
        .btn-outline-#{$-name} {
            @include button-outline-variant($-color);
        }
    }
}

// Button group
// ============================================================================
.btn-group .btn {
    // Ensure that active buttons will always be rendered on top, including
    // hovered ones.
    &:active, &.active, &:active:hover, &.active:hover {
        z-index: 2;
    }
}

// Bootstrap '$theme-colors' text-x and bg-x classes generation
// ============================================================================
// Bootstrap's default behavior is to generate classes directly from its
// '$theme-colors' map. However, we have disabled this to allow our own
// approach.

// 'text-x' classes
// ----------------------------------------------------------------------------
// 1. To comply with WCAG standards, we need to use text-colors that are
//    different from the ones in the '$theme-colors' map. We achieve this by
//    creating a temporary map that overrides uncompliant colors with
//    '$o-theme-text-colors' ones.
$-o-theme-text-colors: map-merge($theme-colors, $o-theme-text-colors);

// 2. Use different colors for links end buttons when in conjunction with
//    'text-x' classes to keep consistency with previous versions of Bootstrap.
//    To do so we pass the values through the 'text-emphasis-variant' mixin.
@each $-name, $-value in $-o-theme-text-colors {
    @include text-emphasis-variant(".text-#{$-name}", $-value);
}

// 3. Cleanup temporary map
$-o-theme-text-colors: null;

// 'bg-x' classes
// ----------------------------------------------------------------------------
// 1. Generate $theme-colors classes using 'o-print-color()' mixin in order to
//    assign the color and print relative CSS variables as well. Note that
//    'black' and 'white' are not included in the map, we'll generate these
//    classes later in conjunction with legacy 'bg-white-x' and 'bg-black-x'
//    ones.
@each $-name, $-color in $theme-colors {
    .bg-#{$-name} {
        @include o-print-color($-color, background-color, bg-opacity);
    }
}


// Bootstrap black/white text-x and bg-x classes + legacy opacity ones
// ============================================================================

// 1. Define placeholder-selectors (aka pseudo-classes) for both white and
//    black. We'll then extend placeholder rather than classes to avoid
//    performance issues during SCSS compilation.
%-text-white {
    @include o-print-color($o-white, color, text-opacity);
}

%-text-black {
    @include o-print-color($o-black, color, text-opacity);
}

%-bg-white {
    @include o-print-color($o-white, background-color, bg-opacity);
}

%-bg-black {
    @include o-print-color($o-black, background-color, bg-opacity);
}

.text-white {
    @extend %-text-white;
}

.text-black {
    @extend %-text-black;
}

.bg-white {
    @extend %-bg-white;
}

.bg-black {
    @extend %-bg-black;
}

// 2. Generate legacy opacity-variations classes for both white and black. We
//    don't specifically assign colors here, we just extend placeholder
//    selectors. To control opacity we act on the '--X-opacity' Bootstrap
//    default CSS variables.
$-o-grayscale-opacities: map-remove($o-opacities, 0, 100);
@each $-name, $-value in $-o-grayscale-opacities {
    .bg-white-#{$-name} {
        --bg-opacity: #{$-value};
        @extend %-bg-white;
    }

    .bg-black-#{$-name} {
        --bg-opacity: #{$-value};
        @extend %-bg-black;
    }
}

@each $-name, $-value in $-o-grayscale-opacities {
    .text-white-#{$-name} {
        --text-opacity: #{$-value};
        @extend %-text-white;
    }

    .text-black-#{$-name} {
        --text-opacity: #{$-value};
        @extend %-text-black;
    }
}

// 3. Cleanup temporary map
$-o-grayscale-opacities: null;


// Odoo custom text/bg colors classes generation
// ============================================================================

// 1. Extend odoo's custom colors maps adding Bootstrap's grays.
//    Note: the card-body rule below needs those grays utilities to be defined
//    before, so that the related o-bg-color text-muted rules work.
$-o-text-colors-custom: map-merge($o-text-colors-custom, $o-grays);
$-o-bg-colors-custom: map-merge($o-bg-colors-custom, $o-grays);

// 2. Generate custom 'text-x' contextual classes
@each $-name, $-color in $-o-text-colors-custom {
    @include text-emphasis-variant(".text-#{$-name}", $-color);
}

// 3. Generate custom 'bg-x' and 'text-bg-x' contextual classes
@each $-name, $-color in map-merge($-o-bg-colors-custom, $o-grays) {
    .bg-#{$-name}, .text-bg-#{$-name}  {
        @include o-print-color($-color, background-color, bg-opacity);
    }

    .text-bg-#{$-name} {
        @include o-print-color(color-contrast($-color), color, text-opacity);
    }
}

// 3. Cleanup temporary maps
$-o-text-colors-custom: null;
$-o-bg-colors-custom: null;

// Cards
// ============================================================================
.card-body {
    @extend %-card-body-reviewed; // See bootstrap_review.scss
}

// Forms
// ==============================================================================
.form-control:hover {
    background-color: $input-focus-bg;
    border-color: $o-input-hover-border-color;
}
