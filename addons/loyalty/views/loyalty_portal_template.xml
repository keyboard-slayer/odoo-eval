<odoo>
    <template id="loyalty_buttons" inherit_id="portal.side_content">
        <xpath expr="//div[@id='portal_contact']" position="after">
            <div class='o_modal_test_selector'>
                <div t-foreach="loyalty_programs" t-as="program" class="portal-loyalty-buttons">
                    <div t-att-data-card="card.id"
                         t-att-data-program="program"
                         t-foreach="loyalty_programs[program]"
                         t-as="card"
                         class="o_modal_test_event_click d-flex my-2">
                        <span t-attf-class="o_notification_bar rounded-start"
                            style="width: 0.5rem; background-color: var(--cyan)"/>
                        <div
                            class="w-100 py-3 ps-3 pe-5 border border-start-0
                                rounded-end d-flex flex-row gap-3"
                        >
                            <img
                                class="img-fluid"
                                t-att-src="'/loyalty/static/src/img/Award.svg'
                                    if program == 'Loyalty Card'
                                    else '/loyalty/static/src/img/Wallet.svg'"
                                width="40"
                            />
                            <div class="d-flex flex-column gap-1">
                                <div>
                                    <strong t-out="card.program_id.display_name"/>
                                </div>
                                <p id="card_points" class="m-0 text-600">
                                    <t t-out="card.points_display"/>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>

    <template id="portal_my_home_loyalty_history" name="Portal layout : loyalty history moves"
        inherit_id="portal.portal_breadcrumbs">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li class="breadcrumb-item" t-if="page_name == 'loyalty_history'">
                <a t-attf-href="/my/history?{{ keep_query() }}">History</a>
            </li>
        </xpath>
    </template>

    <template id="portal_my_history" name="My Loyalty History">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Loyalty Transaction</t>
            </t>
            <t t-if="not move_lines">
                <p class="alert alert-warning">
                    There are currently no transaction lines for this Card.
                </p>
            </t>
            <t t-else="" t-call="portal.portal_table">
              <thead>
                  <tr class="active">
                    <th>Description</th>
                    <th>Order</th>
                    <th>Date</th>
                    <th>Issued</th>
                    <th>Used</th>
                    <th>New Balance</th>
                  </tr>
              </thead>
                <tbody>
                    <t t-foreach="move_lines" t-as="move">
                      <tr>
                            <td><span t-out="move.description"></span></td>
                            <td t-if="move.order_id">
                                <a t-if="move.order_id._name == 'sale.order'" t-att-href="move.order_id.sudo().get_portal_url()">
                                    <t t-out="move.order_id.display_name"/>
                                </a>
                                <t t-else="">
                                    <t t-out="move.order_id.display_name"/>
                                </t>
                            </td>
                            <td t-else=""></td>
                            <td><span t-out="move.date"/></td>
                            <td><span t-out="move.card_id._format_points(move.issued)"/></td>
                            <td><span t-out="move.card_id._format_points(move.used)"/></td>
                            <td><span t-out="move.card_id._format_points(move.new_balance)"/></td>
                        </tr>
                    </t>
                </tbody>
            </t>
        </t>
      </template>
</odoo>
